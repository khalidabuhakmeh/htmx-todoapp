!function(){var l;function i(t){t=l.getAttributeValue(t,"hx-ws");if(t)for(var e=t.trim().split(/\s+/),n=0;n<e.length;n++){var r=e[n].split(/:(.+)/);if("connect"===r[0])return r[1]}}function c(i,c){c.addEventListener(l.getTriggerSpecs(c)[0].trigger,function(t){var e=l.getInternalData(i).webSocket,n=l.getHeaders(c,i),r=l.getInputValues(c,"post"),o=r.errors,a=r.values,r=l.getExpressionVars(c),r=l.mergeObjects(a,r),r=l.filterValues(r,c);r.HEADERS=n,o&&0<o.length?l.triggerEvent(c,"htmx:validation:halted",o):(e.send(JSON.stringify(r)),l.shouldCancel(c)&&t.preventDefault())})}function s(t){var e=htmx.config.wsReconnectDelay;if("function"==typeof e)return e(t);if("full-jitter"===e){t=Math.min(t,6);return 1e3*Math.pow(2,t)*Math.random()}logError('htmx.config.wsReconnectDelay must either be a function or the string "full-jitter"')}function u(t){return!l.bodyContains(t)&&(l.getInternalData(t).webSocket.close(),1)}function e(t){return new WebSocket(t,[])}function f(t,e){var n=[];return(l.hasAttribute(t,e)||l.hasAttribute(t,"hx-ws"))&&n.push(t),t.querySelectorAll("["+e+"], [data-"+e+"], [data-hx-ws], [hx-ws]").forEach(function(t){n.push(t)}),n}function h(t,e){if(t)for(var n=0;n<t.length;n++)e(t[n])}htmx.defineExtension("ws",{init:function(t){l=t,null==htmx.createWebSocket&&(htmx.createWebSocket=e),null==htmx.config.wsReconnectDelay&&(htmx.config.wsReconnectDelay="full-jitter")},onEvent:function(t,e){switch(t){case"htmx:beforeCleanupElement":var n=l.getInternalData(e.target);return void(null!=n.webSocket&&n.webSocket.close());case"htmx:afterProcessNode":h(f(e.target,"ws-connect"),function(t){!function e(a,n){if(!l.bodyContains(a))return;var t=l.getAttributeValue(a,"ws-connect");if(null==t||""===t){var r=i(a);if(null==r)return;t=r}null==n&&(n=0);0==t.indexOf("/")&&(r=location.hostname+(location.port?":"+location.port:""),"https:"==location.protocol?t="wss://"+r+t:"http:"==location.protocol&&(t="ws://"+r+t));var o=htmx.createWebSocket(t);o.onopen=function(t){n=0};o.onclose=function(t){0<=[1006,1012,1013].indexOf(t.code)&&(t=s(n),setTimeout(function(){e(a,n+1)},t))};o.onerror=function(t){l.triggerErrorEvent(a,"htmx:wsError",{error:t,socket:o}),u(a)};o.addEventListener("message",function(t){if(!u(a)){var e=t.data;l.withExtensions(a,function(t){e=t.transformResponse(e,null,a)});var n=l.makeSettleInfo(a),r=l.makeFragment(e);if(r.children.length)for(var o=0;o<r.children.length;o++)l.oobSwap(l.getAttributeValue(r.children[o],"hx-swap-oob")||"true",r.children[o],n);l.settleImmediately(n.tasks)}});h(f(a,"ws-send"),function(t){var e=l.getAttributeValue(t,"hx-ws");e&&"send"!==e||c(a,t)});l.getInternalData(a).webSocket=o}(t)})}}})}();